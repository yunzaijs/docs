"use strict";(self.webpackChunkyunzaijs_website=self.webpackChunkyunzaijs_website||[]).push([[4049],{6537:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var t=s(4848),o=s(8453);const i={sidebar_position:6},r="\u4e2d\u95f4\u4ef6",d={id:"b-next/dev-docs/middleware",title:"\u4e2d\u95f4\u4ef6",description:"\u4e2d\u95f4\u4ef6\u662f\u6709\u522b\u4e8e\u5927\u578b\u5e94\u7528\u7684\uff0c\u662f\u5168\u5c40\u751f\u6548\u7684\u4e2d\u95f4\u5904\u7406\u51fd\u6570",source:"@site/docs/b-next/dev-docs/6-middleware.md",sourceDirName:"b-next/dev-docs",slug:"/b-next/dev-docs/middleware",permalink:"/docs/docs/b-next/dev-docs/middleware",draft:!1,unlisted:!1,editUrl:"https://github.com/yunzaijs/docs/tree/main/docs/b-next/dev-docs/6-middleware.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"\u5b58\u50a8",permalink:"/docs/docs/b-next/dev-docs/stroe-dev"},next:{title:"Module-Shop",permalink:"/docs/docs/category/module-shop"}},a={},c=[{value:"\u7f16\u5199",id:"\u7f16\u5199",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u4e2d\u95f4\u4ef6",children:"\u4e2d\u95f4\u4ef6"})}),"\n",(0,t.jsx)(n.admonition,{title:"\u63d0\u793a",type:"tip",children:(0,t.jsx)(n.p,{children:"\u4e2d\u95f4\u4ef6\u662f\u6709\u522b\u4e8e\u5927\u578b\u5e94\u7528\u7684\uff0c\u662f\u5168\u5c40\u751f\u6548\u7684\u4e2d\u95f4\u5904\u7406\u51fd\u6570"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7f16\u5199",children:"\u7f16\u5199"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="@yunzaijs/mys/message.js"',children:"import { middlewareOptions, useEvent } from 'yunzaijs'\nconst srReg = /^#?(\\*|\u661f\u94c1|\u661f\u8f68|\u7a79\u8f68|\u661f\u7a79|\u5d29\u94c1|\u661f\u7a79\u94c1\u9053|\u5d29\u574f\u661f\u7a79\u94c1\u9053|\u94c1\u9053)+/\nconst zzzReg = /^#?(%|zzz|\u7edd\u533a\u96f6|ZZZ)+/\nexport default () => {\n  // \u8fd4\u56de\u4e2d\u95f4\u4ef6\n  return middlewareOptions({\n    // \u7c7b\u578b\n    typing: 'message',\n    // \u95f4\u4ef6\u540d\n    name: 'mys-message',\n    // \u5904\u7406\u4e8b\u4ef6\n    on: event => {\n      useEvent(\n        e => {\n          //\n          if (srReg.test(e.msg)) {\n            // \u8bbe\u7f6e\u4e3a\u661f\u94c1\n            e.game = 'sr'\n          } else if (zzzReg.test(e.msg)) {\n            e.game = 'zzz'\n          }\n          //\n          if (srReg.test(e.msg)) {\n            // \u91cd\u7f6e\u6d88\u606f -- \u8f6c\u4e3a\u55b5\u55b5\u63d2\u4ef6\u7684\u6d88\u606f\u683c\u5f0f\n            e.msg = e.msg.replace(srReg, '#\u661f\u94c1')\n          } else if (zzzReg.test(e.msg)) {\n            // \u91cd\u7f6e\u6d88\u606f -- \u8f6c\u4e3aZZZ\u63d2\u4ef6\u7684\u6d88\u606f\u683c\u5f0f\n            e.msg = e.msg.replace(srReg, '#\u7edd\u533a\u96f6')\n          }\n        },\n        [event, 'message.group', 'message.private']\n      )\n    }\n  })\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="yunzai.config.js"',children:"import { defineConfig } from 'yunzaijs'\nexport default defineConfig({\n  middlewares: ['@yunzaijs/mys/mw']\n})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { Messages } from 'yunzaijs'\nconst message = new Messages('message.group')\nmessage.use(\n  e => {\n    // \u9ed8\u8ba4 gs\n    console.log('game', e.game)\n    // \u53d1\u9001 * \u53d8\u6210\u4e86 #\u661f\u94c1\n    // \u53d1\u9001 % \u53d8\u6210\u4e86 #\u7edd\u533a\u96f6\n    console.log('msg', e.msg)\n  },\n  // hello #hello /hello\n  [/^#\u7edd\u533a\u96f6\u4fe1\u606f/]\n)\nexport const Word = message.ok\n"})})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>d});var t=s(6540);const o={},i=t.createContext(o);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);